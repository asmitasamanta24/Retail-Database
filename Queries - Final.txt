Q. What are the Top 2 categories of products that students do not prefer to buy? - Jewellery & watches, Toys

SELECT D.CategoryID, CategoryName, sum(Transaction_Amount) as Total_Amount
FROM mydb.order AS A
INNER JOIN mydb.order_has_product AS B
ON A.OrderID=B.OrderID
INNER JOIN mydb.product AS C
on B.ProductID=C.ProductID
INNER JOIN mydb.product_category AS D
on C.CategoryID=D.CategoryID
GROUP BY 1,2
ORDER BY 3 ASC

Q. Which retail store has the most amount of sales ? - Home Depot

SELECT E.Store_Name,E.Store_City,E.Store_State, sum(Transaction_Amount) as Total_Amount
FROM mydb.order AS A
INNER JOIN mydb.order_has_product AS B
ON A.OrderID=B.OrderID
INNER JOIN mydb.product AS C
on B.ProductID=C.ProductID
INNER JOIN mydb.Product_has_store AS D
on C.ProductID=D.ProductID
INNER JOIN mydb.store AS E
ON D.StoreID=E.StoreID
GROUP BY 1,2,3
ORDER BY 3 DESC

Q. How many deliveries were COMPLETED where the ETA is greater than the average of all the deliveries that have been completed till date? Which state has the highest frequency in this case ? - 11, CA

SELECT COUNT(DISTINCT DeliveryID) AS no_of_deliveries 
FROM 
( SELECT DeliveryID, EstimatedDeliveryTime_mins, Delivery_Status FROM  mydb.delivery WHERE Delivery_Status ='Completed') AS A
where EstimatedDeliveryTime_mins > (SELECT TRUNCATE(AVG(EstimatedDeliveryTime_mins),2) AS Avg_ETA  from mydb.delivery)

SELECT Delivery_State, COUNT(DISTINCT DeliveryID) AS no_of_deliveries FROM 
( SELECT DeliveryID, EstimatedDeliveryTime_mins, Delivery_State FROM  mydb.delivery WHERE Delivery_Status ='Completed') AS A
where EstimatedDeliveryTime_mins > (SELECT TRUNCATE(AVG(EstimatedDeliveryTime_mins),2) AS Avg_ETA  from mydb.delivery)
GROUP BY 1
ORDER BY 2 DESC

Q. Which payment ID is most  and least preferred by students ? - Card , Apple or Google Pay

SELECT B.PaymentMethod, COUNT(DISTINCT C.CustomerID) as Total_customers
FROM mydb.order AS A
INNER JOIN mydb.payment AS B
ON A.PaymentID=B.PaymentID
INNER JOIN mydb.customer AS C
ON A.CustomerID=C.CustomerID
GROUP BY 1
ORDER BY 2 DESC

Q. Which products were bought the most - discount ones or discounted ones ? - Non-discount ones, personal care or sports stuff are bought which usually do not have discount


SELECT sum( CASE WHEN C.DISCOUNTID IS NULL THEN Quantity END), sum( CASE WHEN C.DISCOUNTID IS NOT NULL THEN Quantity END)
FROM mydb.order_has_product AS A
INNER JOIN mydb.Product AS B
ON A.ProductID=B.productID
LEFT JOIN mydb.discount AS C
on B.DiscountID=C.DiscountID

Q. What is the trend of delivery agents in each state? How does this relate to the trend of delivery agent having overall maximum rating state-wise?

SELECT Delivery_State, COUNT(DISTINCT B.Delivery_AgentID) as agents
 FROM mydb.delivery AS A
 INNER JOIN mydb.delivery_agent AS B
 ON A.Delivery_AgentID=B.Delivery_AgentID
 GROUP BY 1
ORDER BY 2 DESC;

SELECT  Delivery_State, count(distinct B.Delivery_AgentID) from mydb.delivery AS A
INNER JOIN (
SELECT Delivery_AgentID FROM mydb.delivery_agent AS B
WHERE Agent_Rating = ( SELECT MAX(Agent_Rating) FROM mydb.delivery_agent)) AS B
on A.Delivery_AgentID=B.Delivery_AgentID
Group by 1
ORDER BY 2 DESC

Q. Which state has highest customers and how does this relate to state having highest sales?

SELECT B.Delivery_State, sum(Transaction_Amount) as Total_Amount
FROM mydb.order AS A
INNER JOIN mydb.delivery AS B
ON A.OrderID=B.OrderID
GROUP BY 1
ORDER BY 2 DESC

SELECT State, count(distinct CustomerID) from mydb.customer
Group by 1 

